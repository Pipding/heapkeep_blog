---
layout: post
title:  "Analyzing Code"
date:   2025-02-23 15:00:00 +0000
categories: blog
---
In my [previous post](https://pipding.github.io/heapkeep_blog/blog/2025/02/22/finding-toy-codebase.html) I was looking for a codebase for my experiments. After a lot of searching I settled on the [NeonShooter MonoGame Sample](https://github.com/MonoGame/MonoGame.Samples/tree/a6adeddf022424c032cb76dd9a73c255d4d2b789/NeonShooter). With that sorted, I need a way to analyse the codebase. Like the codebase itself, I didn't expect generating a call graph to be so difficult. I'd done some POC work using a Javascript project and a tool called [code2flow](https://github.com/scottrogowski/code2flow). This was very straightforward so I assumed that if a single developer created a tool to generate decent call graphs for a variety of dynamic languages ~4 years ago, surely something similar would exist for a language as popular as C#. Right...?

# Finding a tool
The aforementioned code2flow won't work because it doesn't support C#, so I need to find something similar with C# support. I'm not the first to look for this, here's a [StackOverflow question from almost 16 years ago](https://stackoverflow.com/questions/793685/c-sharp-call-graph-generation-tool). In all my searching I wasn't able to find a lightweight call graph generator for C#. Here's what I tried:

### [csharp-call-graph](https://github.com/vinitsiriya/csharp-call-graph)
I spent the better part of an evening trying to get this to work. I _think_ I got the core functionality working but the problem is it relies on Neo4j, a graph database management system, for displaying the graph information (I think). I have no experience with Neo4j and the instructions on the csharp-call-graph repo don't go into detail on how to use it, so I eventually gave up.

### [Crabvis](https://github.com/chanhx/crabviz)
Crabvis seemed promising - a lightweight VSCode plugin which can generate a call graph from a set of files. Built on LSP (Language Server Protocol), it appears to support multiple languages. The image below, taken from the crabvis git repo, looks like just what I need.

<p style="text-align: center;">
  <img src="{{ "/assets/images/2025-02-23-crabvis.gif" | relative_url }}" alt="An animated gif showing a crabvis user generating a call graph" style="max-width: 100%; height: auto;">
</p>

Unfortunately, my own attempts were less successful. When I used crabvis on the `NeonShooter` codebase, it would generate a single column of classes with no connections. I'll include the generated graph below but it is illegible at this scale. If I leave it at its default scale it will take up far too much space.

<p style="text-align: center;">
  <img src="{{ "/assets/images/2025-02-23-crabvis-neon.svg" | relative_url }}" alt="An incomplete call graph generated by crabvis, with no connections between nodes" style="height: 1000px;">
</p>

### Jetbrains Rider/Resharper
[One StackOverflow user](https://stackoverflow.com/a/44318418) suggested [ReSharper](https://www.jetbrains.com/resharper/), part of the Jetbrains IDE suite. ReSharper is a Visual Studio extension but many of its features are also built into Jetbrains IDEs like Rider or IDEA. I have a Jetbrains license so I tried it out. As far as I can tell, Jetbrains IDEs don't have built-in call graph generation. I think the StackOverflow user answered a question _similar to_ the one asked, but not quite. They were just saying ReSharper can list incoming and outgoing calls, not generate a graph. For the record, I did also try using Rider's built-in UML diagram generation, but it would just tell me repeatedly that it was unable to find diagrams.

<p style="text-align: center;">
  <img src="{{ "/assets/images/2025-02-23-rider-unable-uml.png" | relative_url }}" alt="A warning message displayed in Jetbrains Rider when it fails to find a UML diagram" style="max-width: 100%; height: auto;">
</p>

### NDepend
I was deliberately avoiding Ndepend because it's an enterprise solution with an enterprise price tag. They allow for a 14 day evaluation period and to be honest, it does seem like a very robust toolset. Within about 10 minutes of installing NDepend I had generated a report that included not only a call graph but a dependency matrix, code health analysis and a list of identified issues. The report is generated as a static webpage, so I'll include the report in full below.
#### [NeonShooter NDepend Analysis]({{ "assets/webpages/ndepend/reports/neonshooter_2025-02-22/NDependReport.html" | relative_url }})

# Verdict
If I can, I'd like to stick with NDepend. It's really robust and seems to offer everything I need. The static report only shows the basics but it also generates an interactive call graph which could be really useful.